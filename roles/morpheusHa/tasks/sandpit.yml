--- 
- name: Get first IP address of host in the morph group. This will be our SOT node for RabbitMQ clustering
  set_fact:
    rabbitmq_sot: "{{ groups['morph'] | map('extract', hostvars, ['ansible_eth0', 'ipv4', 'address']) | list | sort | first}}"

- debug:
    var: rabbitmq_sot

- debug:
    var: rabbitmq_sot_bind_address

- debug:
    var: ansible_eth0.ipv4.address

- debug:
    var: ansible_hostname

- name: Get hostname of the SOT node
  set_fact:
    rabbitmq_sot_name: "{{ ansible_hostname }}"
  when: ansible_eth0.ipv4.address == "{{ rabbitmq_sot }}"

- debug:
    var: rabbitmq_sot_name

- name: Get hostname
  set_fact:
    #rabbitmq_sot_hostname: "{{ hostvars[rabbitmq_sot][ansible_hostname] }}"
    rabbitmq_sot_hostname: "{{ hostvars['ansible_eth0', 'ipv4', 'address'][ansible_hostname] }}"
- debug:
    var: rabbitmq_sot_hostname

